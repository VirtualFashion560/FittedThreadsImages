<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitted Threads Try-On</title>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
<style>
 body { margin:0; background:linear-gradient(135deg,#a46237,#d9b382); color:#4b3221; font-family:'Poppins',sans-serif; text-align:center; padding:20px; min-height:100vh; }
 h1 { font-family:'Pacifico',cursive; font-size:3rem; color:#6e4b26; margin-bottom:0.3em; }
 .preview-container, .ai-container { display:flex; justify-content:center; gap:20px; margin:1em 0; flex-wrap:wrap; }
 .preview-container img, .ai-container img, .ai-container video { max-width:250px; max-height:250px; border-radius:12px; }
 .section { background: rgba(217,179,130,0.85); padding:1.5em 2em; border-radius:12px; max-width:600px; margin:2em auto; color:#4b3221; text-align:center; box-shadow:0 0 10px rgba(141,102,58,0.3); }
 .section h2 { font-size:1.8rem; margin-bottom:1em; color:#6e4b26; }
 .btn { padding:10px 25px; font-size:1.1rem; font-weight:600; border:none; border-radius:8px; cursor:pointer; background-color:#6e4b26; color:#fff; transition:0.3s; }
 .btn:hover { background-color:#7a5a34; }
 .loader { margin:1em auto; border:6px solid #f3f3f3; border-top:6px solid #6e4b26; border-radius:50%; width:50px; height:50px; animation:spin 1s linear infinite; display:none;}
 @keyframes spin { 0% { transform:rotate(0deg);} 100% { transform:rotate(360deg);} }
</style>
</head>
<body>

<h1>Fitted Threads Try-On</h1>

<div class="preview-container">
 <img id="selfPreview" alt="Self Preview"/>
 <img id="clothPreview" alt="Clothing Preview"/>
</div>

<div class="section">
 <h2>AI-Generated Image</h2>
 <div class="ai-container" id="aiImageContainer">
 <div class="loader" id="imageLoader"></div>
 </div>
</div>

<div class="section">
 <h2>AI-Generated Video</h2>
 <div class="ai-container" id="aiVideoContainer">
 <div class="loader" id="videoLoader"></div>
 </div>
</div>

<script>
 const selfPreview = document.getElementById('selfPreview');
 const clothPreview = document.getElementById('clothPreview');
 const aiImageContainer = document.getElementById('aiImageContainer');
 const aiVideoContainer = document.getElementById('aiVideoContainer');
 const imageLoader = document.getElementById('imageLoader');
 const videoLoader = document.getElementById('videoLoader');

 const selfImage = sessionStorage.getItem('selfImage');
 const clothImage = sessionStorage.getItem('clothImage');

 if(!selfImage || !clothImage){
 alert('Please upload images first.');
 window.location.href = 'index.html';
 }

 // Show previews
 selfPreview.src = selfImage;
 clothPreview.src = clothImage;

 async function generateTryOn(){
 try{
 imageLoader.style.display = 'block';
 videoLoader.style.display = 'block';

 const response = await fetch('/api/generate-tryon', {
 method:'POST',
 headers:{ 'Content-Type':'application/json' },
 body: JSON.stringify({ selfImage, clothImage })
 });

 if(!response.ok) throw new Error('Failed to generate AI try-on');

 const data = await response.json();

 // data should contain: { imageUrl: "...", videoUrl: "..." }
 const aiImg = document.createElement('img');
 aiImg.src = data.imageUrl;
 aiImg.alt = "AI Generated Image";

 const aiVid = document.createElement('video');
 aiVid.src = data.videoUrl;
 aiVid.controls = true;
 aiVid.autoplay = false;

 aiImageContainer.innerHTML = '';
 aiVideoContainer.innerHTML = '';
 aiImageContainer.appendChild(aiImg);
 aiVideoContainer.appendChild(aiVid);

 }catch(err){
 console.error(err);
 aiImageContainer.innerHTML = '<p>Failed to generate AI image.</p>';
 aiVideoContainer.innerHTML = '<p>Failed to generate AI video.</p>';
 }finally{
 imageLoader.style.display = 'none';
 videoLoader.style.display = 'none';
 }
 }

 generateTryOn();
</script>

</body>
</html>
