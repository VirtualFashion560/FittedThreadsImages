<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Fitted Threads Try-On</title>
 <link rel="stylesheet" href="styles.css">
 <style>
 body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; background: #f5f5f5; }
 header { display: flex; align-items: center; padding: 10px; background: #fff; }
 header a { text-decoration: none; color: #333; font-size: 24px; margin-right: auto; }
 h1 { margin: 20px 0 10px; }
 #uploads, #aiResultContainer { display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap; }
 img { max-width: 200px; border: 2px solid #ccc; border-radius: 5px; }
 button { padding: 10px 20px; margin: 10px; cursor: pointer; font-size: 16px; }
 #catalog { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin: 20px 0; overflow-x: auto; }
 #catalog img { width: 150px; height: 200px; object-fit: cover; cursor: pointer; border: 2px solid transparent; }
 #catalog img:hover { border-color: #007bff; }
 footer { background: #333; color: #fff; padding: 20px; }
 footer a { color: #fff; margin: 0 10px; text-decoration: none; }
 .social-icons img { width: 32px; height: 32px; margin: 0 5px; }
 </style>
</head>
<body>

<header>
 <a href="index.html">&#8592; Home</a>
</header>

<h1>Fitted Threads Try-On</h1>

<div id="uploads">
 <img id="photoPreview" src="" alt="User Photo" style="display:none;">
 <img id="clothingPreview" src="" alt="Clothing Item" style="display:none;">
</div>

<div>
 <button id="retakeBtn">Retake</button>
 <button id="generateBtn">Generate AI</button>
</div>

<div id="aiResultContainer">
 <img id="aiResult" src="" alt="AI Result" style="display:none;">
</div>

<div>
 <button id="saveBtn">Save AI Result</button>
</div>

<h2>Clothing Catalog</h2>
<div id="catalog">
 <img src="https://images.unsplash.com/photo-1618354699263-8396f80c5f5c?auto=format&fit=crop&w=150&q=80" alt="Clothing 1">
 <img src="https://images.unsplash.com/photo-1602810310343-7d024f1fc4f3?auto=format&fit=crop&w=150&q=80" alt="Clothing 2">
 <img src="https://images.unsplash.com/photo-1618354699263-8396f80c5f5c?auto=format&fit=crop&w=150&q=80" alt="Clothing 3">
 <img src="https://images.unsplash.com/photo-1602810310343-7d024f1fc4f3?auto=format&fit=crop&w=150&q=80" alt="Clothing 4">
</div>

<footer>
 <div class="social-icons">
 <a href="#"><img src="icons/facebook.png" alt="Facebook"></a>
 <a href="#"><img src="icons/instagram.png" alt="Instagram"></a>
 </div>
 <div>
 <a href="privacy.html">Privacy Policy</a> |
 <a href="terms.html">Terms & Conditions</a> |
 <a href="about.html">About Us</a> |
 <a href="contact.html">Contact Us</a>
 </div>
</footer>

<script>
 // Load uploaded images from sessionStorage
 const photoFile = sessionStorage.getItem('photoFile');
 const clothingFile = sessionStorage.getItem('clothingFile');

 if(photoFile) {
 const photoPreview = document.getElementById('photoPreview');
 photoPreview.src = photoFile;
 photoPreview.style.display = 'inline-block';
 }
 if(clothingFile) {
 const clothingPreview = document.getElementById('clothingPreview');
 clothingPreview.src = clothingFile;
 clothingPreview.style.display = 'inline-block';
 }

 // Retake
 document.getElementById('retakeBtn').onclick = () => {
 sessionStorage.removeItem('photoFile');
 sessionStorage.removeItem('clothingFile');
 window.location.href = 'index.html';
 }

 // Generate AI
 document.getElementById('generateBtn').onclick = async () => {
 const aiResult = document.getElementById('aiResult');
 aiResult.style.display = 'block';
 aiResult.src = 'loading.gif'; // optional loading gif

 const formData = new FormData();
 formData.append('photo', dataURLtoFile(photoFile, 'photo.png'));
 formData.append('clothing', dataURLtoFile(clothingFile, 'clothing.png'));

 const response = await fetch('http://localhost:3000/generate-ai', {
 method: 'POST',
 body: formData
 });

 const result = await response.json();
 aiResult.src = result.image;
 }

 // Save button placeholder
 document.getElementById('saveBtn').onclick = () => {
 alert('Redirect to save page (set up later)');
 }

 // Helper to convert dataURL to File
 function dataURLtoFile(dataurl, filename) {
 let arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1];
 let bstr = atob(arr[1]);
 let n = bstr.length;
 let u8arr = new Uint8Array(n);
 while(n--){
 u8arr[n] = bstr.charCodeAt(n);
 }
 return new File([u8arr], filename, {type:mime});
 }

 // Clothing catalog swap
 const catalogImgs = document.querySelectorAll('#catalog img');
 catalogImgs.forEach(img => {
 img.addEventListener('click', () => {
 const clothingPreview = document.getElementById('clothingPreview');
 clothingPreview.src = img.src;
 });
 });
</script>

</body>
</html>
