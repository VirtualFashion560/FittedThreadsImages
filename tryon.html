<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fitted Threads - Try On</title>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
margin:0;
background:linear-gradient(135deg,#d9b382,#a46237);
font-family:'Poppins',sans-serif;
color:#4b3221;
text-align:center;
padding:20px;
min-height:100vh;
}
h1 { font-family:'Pacifico',cursive; font-size:3rem; margin-bottom:0.5em; color:#6e4b26; }
.preview-container, .ai-results { display:flex; justify-content:center; gap:20px; flex-wrap:wrap; margin:1em 0; }
.preview-container img, .ai-results img, .ai-results video { max-width:300px; max-height:300px; border-radius:12px; }
.btn { padding:10px 25px; font-size:1.1rem; font-weight:600; border:none; border-radius:8px; cursor:pointer; background-color:#6e4b26; color:#fff; transition:0.3s; margin-top:1em; }
.btn:hover { background-color:#7a5a34; }
.loader { margin-top:20px; font-weight:bold; color:#6e4b26; }
</style>
</head>
<body>

<h1>Virtual Try-On</h1>

<div class="preview-container" id="previewContainer">
<img id="selfPreview" src="" alt="Self Preview"/>
<img id="clothPreview" src="" alt="Clothing Preview"/>
</div>

<div>
<button class="btn" id="generateBtn">Generate AI Try-On</button>
</div>

<div class="loader" id="loader" style="display:none;">Generating AI content, please wait...</div>

<div class="ai-results" id="aiResults"></div>

<script>
const selfPreview = document.getElementById('selfPreview');
const clothPreview = document.getElementById('clothPreview');
const generateBtn = document.getElementById('generateBtn');
const loader = document.getElementById('loader');
const aiResults = document.getElementById('aiResults');

const selfImage = localStorage.getItem('selfImage');
const clothImage = localStorage.getItem('clothImage');

if (!selfImage || !clothImage) {
alert('Please upload images first on index.html');
window.location.href = 'index.html';
} else {
selfPreview.src = selfImage;
clothPreview.src = clothImage;
}

// Call backend API to generate AI image/video
generateBtn.addEventListener('click', async () => {
loader.style.display = 'block';
aiResults.innerHTML = '';

try {
const response = await fetch('/api/tryon', { // backend endpoint
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ selfImage, clothImage })
});

const data = await response.json();

if (data.aiImage) {
const img = document.createElement('img');
img.src = data.aiImage;
img.alt = 'AI Generated Try-On';
aiResults.appendChild(img);
}

if (data.aiVideo) {
const video = document.createElement('video');
video.src = data.aiVideo;
video.controls = true;
aiResults.appendChild(video);
}

} catch (err) {
alert('Error generating AI content. Please try again.');
console.error(err);
} finally {
loader.style.display = 'none';
}
});
</script>

</body>
</html>
