<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fitted Threads - Try On</title>
<style>
 body { margin:0; font-family:'Poppins',sans-serif; background:linear-gradient(135deg,#a46237,#d9b382); color:#4b3221; display:flex; flex-direction:row; min-height:100vh; }
 .main { flex:3; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px; }
 h1 { font-family:'Pacifico',cursive; font-size:2.5rem; margin-bottom:0.5em; }
 #selfImage, #clothingImage, #aiResult { max-width:300px; max-height:400px; display:block; margin:10px auto; border-radius:10px; }
 .catalog { flex:1; background: rgba(217,179,130,0.85); padding:1em; overflow-y:auto; max-width:250px; }
 .category-header { font-weight:bold; margin-top:10px; cursor:pointer; }
 .category-items { display:flex; flex-direction:column; margin-top:5px; }
 .dropdown-item { display:flex; align-items:center; margin:5px 0; cursor:pointer; }
 .dropdown-item img { width:40px; height:40px; margin-right:10px; border-radius:5px; }
 .btn { padding:10px 20px; margin:5px; border:none; border-radius:8px; cursor:pointer; background:#6e4b26; color:#fff; font-weight:600; }
 .btn:hover { background:#7a5a34; }
</style>
</head>
<body>

<div class="main">
 <h1>Try On Your Outfit</h1>
 <input type="file" id="selfInput" accept="image/*" style="display:none">
 <input type="file" id="clothingInput" accept="image/*" style="display:none">

 <button class="btn" id="uploadSelfBtn">Upload Self Image</button>
 <button class="btn" id="uploadClothingBtn">Upload Clothing/Accessory</button>

 <img id="selfImage" src="" alt="Your Photo" style="display:none">
 <img id="clothingImage" src="" alt="Clothing" style="display:none">
 <img id="aiResult" src="" alt="AI Result" style="display:none">

 <button class="btn" id="applyAI">Apply AI</button>
</div>

<div class="catalog" id="catalogItemsContainer">
 <!-- Dynamic catalog items will appear here -->
</div>

<script>
const uploadSelfBtn = document.getElementById('uploadSelfBtn');
const uploadClothingBtn = document.getElementById('uploadClothingBtn');
const selfInput = document.getElementById('selfInput');
const clothingInput = document.getElementById('clothingInput');
const selfImage = document.getElementById('selfImage');
const clothingImage = document.getElementById('clothingImage');
const aiResult = document.getElementById('aiResult');
const applyAI = document.getElementById('applyAI');

let selfFile = null;
let clothingFile = null;

uploadSelfBtn.addEventListener('click',()=>selfInput.click());
uploadClothingBtn.addEventListener('click',()=>clothingInput.click());

selfInput.addEventListener('change',(e)=>{
 selfFile=e.target.files[0];
 if(selfFile){
 const reader=new FileReader();
 reader.onload=(ev)=>{
 selfImage.src=ev.target.result;
 selfImage.style.display='block';
 aiResult.style.display='none';
 };
 reader.readAsDataURL(selfFile);
 }
});

clothingInput.addEventListener('change',(e)=>{
 clothingFile=e.target.files[0];
 if(clothingFile){
 const reader=new FileReader();
 reader.onload=(ev)=>{
 clothingImage.src=ev.target.result;
 clothingImage.style.display='block';
 aiResult.style.display='none';
 };
 reader.readAsDataURL(clothingFile);
 }
});

applyAI.addEventListener('click', async ()=>{
 if(!selfFile || !clothingFile){
 alert('Please upload both self image and clothing.');
 return;
 }

 aiResult.style.display='block';
 aiResult.src='loading.gif'; // optional loading spinner

 const formData = new FormData();
 formData.append('self', selfFile);
 formData.append('clothing', clothingFile);

 try {
 const response = await fetch('YOUR_AI_API_ENDPOINT', {
 method: 'POST',
 body: formData
 });

 if(!response.ok) throw new Error('AI API error');

 const blob = await response.blob();
 aiResult.src = URL.createObjectURL(blob);

 aiResult.onload = ()=>{
 aiResult.width=selfImage.width;
 aiResult.height=selfImage.height;
 };
 } catch(err){
 alert('Error generating AI try-on: '+err.message);
 }
});

// Dynamic catalog fetch
const catalogItemsContainer = document.getElementById('catalogItemsContainer');
let currentClothing = '';

async function fetchCatalog() {
 try {
 const response = await fetch('catalog.json'); // fetch from server
 const catalog = await response.json();
 renderCatalog(catalog);
 } catch(err){
 console.error('Error loading catalog:', err);
 }
}

function swapClothing(imgSrc){
 currentClothing = imgSrc;
 clothingImage.src = imgSrc;
 applyAI.click();
}

function renderCatalog(cat){
 catalogItemsContainer.innerHTML='';
 Object.keys(cat).forEach(category=>{
 const catDiv=document.createElement('div');
 const header=document.createElement('div');
 header.className='category-header';
 header.textContent=category;
 const itemsDiv=document.createElement('div');
 itemsDiv.className='category-items';

 header.addEventListener('click',()=> {
 itemsDiv.style.display=itemsDiv.style.display==='flex' ? 'none' : 'flex';
 });

 cat[category].forEach(item=>{
 const div=document.createElement('div');
 div.className='dropdown-item';
 div.innerHTML=`<img src="${item.image}" alt="${item.name}"><span>${item.name}</span>`;
 div.onclick = ()=>swapClothing(item.image);
 itemsDiv.appendChild(div);
 });

 catDiv.appendChild(header);
 catDiv.appendChild(itemsDiv);
 catalogItemsContainer.appendChild(catDiv);
 });
}

// Initialize catalog
fetchCatalog();
</script>
</body>
</html>
