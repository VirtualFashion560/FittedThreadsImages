<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fitted Threads - Try On</title>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
<style>
body { margin:0; font-family:'Poppins',sans-serif; background:#f9f3ef; color:#4b3221; text-align:center; padding:20px;}
h1 { font-family:'Pacifico',cursive; font-size:3rem; color:#6e4b26; margin-bottom:0.3em; }
.images { display:flex; justify-content:center; gap:20px; margin:20px 0; flex-wrap:wrap;}
.images img { max-width:250px; max-height:250px; border-radius:12px; border:2px solid #6e4b26; }
.generated { margin-top:2em; }
.generated img, .generated video { max-width:400px; border-radius:12px; margin:10px 0; border:2px solid #6e4b26; }
.btn { padding:10px 25px; font-size:1.1rem; font-weight:600; border:none; border-radius:8px; cursor:pointer; background-color:#6e4b26; color:#fff; transition:0.3s; margin-top:1em;}
.btn:hover { background-color:#7a5a34; }
.loader { border: 6px solid #f3f3f3; border-top: 6px solid #6e4b26; border-radius: 50%; width:50px; height:50px; animation: spin 1s linear infinite; margin:20px auto; display:none;}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</head>
<body>

<h1>Fitted Threads - Try On</h1>

<div class="images">
<img id="selfPreview" src="" alt="Self Image"/>
<img id="clothPreview" src="" alt="Clothing Image"/>
</div>

<div class="generated">
<h2>AI Generated Image</h2>
<div class="loader" id="imageLoader"></div>
<img id="aiImage" src="" alt="AI Try-On Result"/>
</div>

<div class="generated">
<h2>AI Generated Video</h2>
<div class="loader" id="videoLoader"></div>
<video id="aiVideo" controls autoplay loop></video>
</div>

<button class="btn" id="regenerateBtn">Regenerate</button>

<script>
const selfPreview = document.getElementById('selfPreview');
const clothPreview = document.getElementById('clothPreview');
const aiImage = document.getElementById('aiImage');
const aiVideo = document.getElementById('aiVideo');
const imageLoader = document.getElementById('imageLoader');
const videoLoader = document.getElementById('videoLoader');
const regenerateBtn = document.getElementById('regenerateBtn');

const selfData = localStorage.getItem('selfImage');
const clothData = localStorage.getItem('clothImage');

if(!selfData || !clothData){
alert("Please upload images first on the home page.");
window.location.href = "index.html";
} else {
selfPreview.src = selfData;
clothPreview.src = clothData;
generateAI();
}

regenerateBtn.addEventListener('click', generateAI);

async function generateAI() {
aiImage.src = '';
aiVideo.src = '';
imageLoader.style.display = 'block';
videoLoader.style.display = 'block';

try {
// Generate AI Image
const imgResp = await fetch('/generate-image', {
method:'POST',
headers: { 'Content-Type':'application/json' },
body: JSON.stringify({ selfImage: selfData, clothImage: clothData })
});
const imgData = await imgResp.json();
aiImage.src = imgData.url;
imageLoader.style.display = 'none';

// Generate AI Video
const vidResp = await fetch('/generate-video', {
method:'POST',
headers: { 'Content-Type':'application/json' },
body: JSON.stringify({ selfImage: selfData, clothImage: clothData })
});
const vidData = await vidResp.json();
aiVideo.src = vidData.url;
videoLoader.style.display = 'none';

} catch(e) {
console.error(e);
alert("Error generating AI results. Try again.");
imageLoader.style.display = 'none';
videoLoader.style.display = 'none';
}
}
</script>

</body>
</html>
